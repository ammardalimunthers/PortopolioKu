<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Portfolio Builder — Final v3</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
  :root{
    --radius:14px;
    --maxw:1200px;
    --accent:#7c5cff;
    --muted-light: rgba(255,255,255,0.96);
    --muted-dark: rgba(0,0,0,0.78);
    --card-shadow: 0 18px 60px rgba(2,6,23,0.55);
    --white: #ffffff;
    --mono-icon: #ffffff;
  }
  html,body{height:100%;margin:0;font-family:'Poppins',sans-serif;background:#07071a;color:var(--muted-light);-webkit-font-smoothing:antialiased}
  *,*::before,*::after{box-sizing:border-box}
  a{color:inherit}
  /* root container */
  #root{width:100%;max-width:var(--maxw);margin:0 auto;padding:32px;min-height:100vh;position:relative;z-index:2}
  /* themes set root class */
  .theme-portfolio #app{background:linear-gradient(135deg,#1f1c2c,#3a2f7a); color:var(--muted-light)}
  .theme-profile  #app{background:linear-gradient(135deg,#43cea2,#185a9d); color:var(--muted-dark)}
  .theme-project  #app{background:linear-gradient(135deg,#ff9966,#ff5e62); color:var(--muted-dark)}

  /* decorative blobs */
  .blobs{position:fixed;inset:-12% -6% auto auto;pointer-events:none;z-index:0}
  .blob{width:520px;height:520px;border-radius:50%;position:absolute;filter:blur(54px);opacity:0.12}
  .theme-portfolio .b1{background:radial-gradient(circle at 30% 30%, #6a11cb, transparent 40%);top:-6%;left:-6%}
  .theme-portfolio .b2{background:radial-gradient(circle at 70% 70%, #2575fc, transparent 40%);top:8%;left:40%}

  /* progress */
  #progress{position:fixed;left:0;top:0;height:4px;background:linear-gradient(90deg,var(--accent),#4ad0ff);width:0;z-index:80;border-radius:0 0 6px 6px}

  header{display:flex;align-items:center;justify-content:space-between;gap:18px;margin-bottom:26px}
  .brand{display:flex;gap:14px;align-items:center}
  .logo{width:66px;height:66px;border-radius:50%;overflow:hidden;background:rgba(255,255,255,0.04);display:grid;place-items:center;box-shadow:0 10px 30px rgba(0,0,0,0.25)}
  .logo img{width:100%;height:100%;object-fit:cover;display:block;transition:transform .45s ease}
  .brand h1{margin:0;font-size:20px}
  .brand p{margin:0;font-size:13px;opacity:.95}
  nav .menu{display:flex;gap:12px}
  nav a{color:inherit;text-decoration:none;font-weight:600;padding:8px 12px;border-radius:10px}
  nav a:hover{transform:translateY(-4px)}

  main{position:relative;z-index:10}
  .layout{display:grid;grid-template-columns:1fr 380px;gap:30px;align-items:start}
  .card{background:rgba(255,255,255,0.03);border-radius:18px;padding:22px;box-shadow:var(--card-shadow);backdrop-filter:blur(6px)}
  .card.flat{background:transparent;box-shadow:none;padding:0}
  .small-muted{font-size:13px;opacity:.95}

  /* hero */
  .hero h2{margin:0 0 8px 0;font-size:30px;line-height:1.05}
  .hero p{margin:0 0 14px 0;opacity:.95}
  .controls{display:flex;gap:10px;flex-wrap:wrap}
  .btn{background:rgba(255,255,255,0.12);border:none;padding:10px 14px;border-radius:12px;font-weight:700;color:inherit;cursor:pointer;transition:transform .18s,box-shadow .18s}
  .btn.primary{background:var(--accent);color:#fff;box-shadow:0 12px 30px rgba(124,92,255,0.18)}
  .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06)}
  .btn:hover{transform:translateY(-4px)}

  /* avatar */
  .avatar{width:200px;height:200px;border-radius:50%;overflow:hidden;display:grid;place-items:center;
          box-shadow:0 18px 50px rgba(124,92,255,0.14), 0 6px 20px rgba(0,0,0,0.35);border:4px solid rgba(255,255,255,0.06)}
  .avatar img{width:100%;height:100%;object-fit:cover;display:block;transition:transform .6s}
  .avatar:hover img{transform:scale(1.02)}

  /* skills */
  .skills{display:flex;gap:10px;flex-wrap:wrap;margin-top:8px}
  .skill{background:rgba(255,255,255,0.06);padding:8px 12px;border-radius:999px;font-weight:700;transform:translateY(8px);opacity:0;transition:all .36s ease}

  /* projects */
  .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:18px;margin-top:6px}
  .project{background:rgba(255,255,255,0.03);padding:12px;border-radius:12px;display:flex;flex-direction:column;gap:10px;transition:transform .28s,box-shadow .28s}
  .project:hover{transform:translateY(-10px);box-shadow:0 26px 60px rgba(0,0,0,0.4)}
  .project img{width:100%;height:160px;object-fit:cover;border-radius:10px}
  .links{display:flex;gap:8px;margin-top:auto}
  .chip{padding:8px 10px;border-radius:10px;background:rgba(255,255,255,0.03);font-weight:600}

  /* socials (monochrome white icons) */
  .socials{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
  .socials a{display:inline-grid;place-items:center;width:42px;height:42px;border-radius:10px;background:rgba(255,255,255,0.03);text-decoration:none}
  .socials svg{width:20px;height:20px;fill:var(--mono-icon);opacity:0.98}

  /* forms */
  .field{display:flex;flex-direction:column;gap:8px;margin-bottom:12px}
  input[type="text"], input[type="email"], textarea, select{
    padding:12px;border-radius:12px;border:1px solid rgba(0,0,0,0.06);font-size:14px;width:100%;min-width:0;background:rgba(255,255,255,0.96);color:#111
  }
  textarea{min-height:120px;resize:vertical}

  /* page overlay (solid backgrounds behind & white card on top) */
  .page-full{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;z-index:120;padding:18px;transition:opacity .2s}
  .theme-profile .page-full{background:linear-gradient(180deg,#43cea2,#185a9d)}
  .theme-project .page-full{background:linear-gradient(180deg,#ff9966,#ff5e62)}
  .page-card{width:100%;max-width:980px;border-radius:16px;padding:20px;background:rgba(255,255,255,0.98);box-shadow:0 30px 90px rgba(0,0,0,0.5);color:#111}
  .page-title{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px}

  /* responsive */
  @media (max-width:1100px){ .layout{grid-template-columns:1fr 340px} .grid{grid-template-columns:repeat(2,1fr)} }
  @media (max-width:720px){
    #root{padding:18px}
    header{flex-direction:column;align-items:flex-start;gap:12px}
    .layout{grid-template-columns:1fr}
    .avatar{width:140px;height:140px}
    .logo{width:52px;height:52px}
    .grid{grid-template-columns:1fr}
    .socials a{width:36px;height:36px}
  }
</style>
</head>
<body>
  <div id="progress"></div>

  <div class="blobs">
    <div class="blob b1"></div>
    <div class="blob b2"></div>
  </div>

  <div id="root" class="">
    <div id="app" role="main">
      <header>
        <div class="brand">
          <div class="logo" id="logoWrap"><img id="logoImg" src="" alt="logo"></div>
          <div>
            <h1 id="titleName"></h1>
            <p id="titleRole" class="small-muted"></p>
          </div>
        </div>
        <nav>
          <div class="menu">
            <a href="#home" id="navHome">Home</a>
            <a href="#projects" id="navProjects">Projects</a>
            <a href="#contact" id="navContact">Contact</a>
          </div>
        </nav>
      </header>

      <main>
        <div class="layout">
          <section class="card hero" id="home">
            <div class="reveal" id="heroBlock">
              <h2 id="heroGreeting"></h2>
              <p id="heroDesc" class="small-muted"></p>

              <div style="margin:14px 0">
                <div style="font-weight:700;margin-bottom:8px">saya — <span id="typed"></span></div>
                <div class="controls">
                  <button class="btn primary" id="openAddProject">Tambah Proyek</button>
                  <button class="btn ghost" id="openEditProfile">Edit Profil</button>
                  <button class="btn ghost" id="btnExport">Export JSON</button>
                  <button class="btn ghost" id="btnImport">Import JSON</button>
                  <button class="btn ghost" id="btnReset">Reset Data</button>
                </div>
              </div>

              <div style="margin-top:18px">
                <div class="section-title"><h3>About</h3></div>
                <p id="aboutText" class="small-muted"></p>

                <div style="margin-top:14px">
                  <div class="section-title"><h3>Skills</h3></div>
                  <div class="skills" id="skillsWrap"></div>
                </div>
              </div>
            </div>
          </section>

          <aside class="card profile-card">
            <div style="display:flex;flex-direction:column;align-items:center;gap:14px">
              <div class="avatar" id="avatarWrap" style="animation:floaty 6s ease-in-out infinite"><img id="avatarImg" src="" alt="avatar"></div>
              <div style="text-align:center">
                <div id="nameShort" style="font-weight:700;font-size:18px"></div>
                <div id="roleShort" class="small-muted"></div>
              </div>

              <div class="socials" id="socialsWrap" aria-hidden="false">
                <!-- social icons inserted by JS -->
              </div>
            </div>
          </aside>
        </div>

        <svg class="wave" viewBox="0 0 1200 100" preserveAspectRatio="none"><path d="M0,30 C150,120 350,0 600,40 C850,80 1050,20 1200,50 L1200,100 L0,100 Z" fill="rgba(255,255,255,0.06)"></path></svg>

        <section id="projects" class="reveal">
          <div class="section-title"><h3>Projects</h3></div>
          <div class="grid" id="projectsGrid"></div>
        </section>

        <section id="contact" class="card reveal" style="margin-top:18px">
          <div class="section-title"><h3>Contact</h3></div>
          <div style="display:flex;gap:16px;flex-wrap:wrap">
            <div style="flex:1;min-width:260px">
              <p class="small-muted">Gunakan form di samping untuk mengirim pesan via WhatsApp. Pastikan Nomor WA diisi dalam Edit Profil (format internasional, contoh: <code>6281234567890</code>).</p>
              <div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:10px">
                <div class="chip" id="emailChip"></div>
                <div class="chip" id="githubChip"></div>
                <div class="chip" id="linkedinChip"></div>
              </div>

              <div style="margin-top:12px">
                <div class="section-title"><h4>Media Sosial</h4></div>
                <div class="socials" id="socialsContact">
                  <!-- replicated icons for contact area -->
                </div>
              </div>
            </div>

            <div style="min-width:320px">
              <form id="contactForm" onsubmit="return false">
                <div class="field"><input type="text" id="contactName" placeholder="Nama" required></div>
                <div class="field"><input type="email" id="contactEmail" placeholder="Email" required></div>
                <div class="field"><textarea id="contactMessage" placeholder="Pesan..." required></textarea></div>
                <div style="display:flex;gap:8px">
                  <button class="btn primary" id="contactSend">Kirim via WhatsApp</button>
                  <button class="btn ghost" id="contactClear" type="button">Bersihkan</button>
                </div>
                <p class="small-muted" style="margin-top:8px;font-size:13px">Pesan otomatis: <em>Halo, saya tertarik dengan portfolio Anda di website ini.</em></p>
              </form>
            </div>
          </div>
        </section>

        <footer style="margin-top:18px;text-align:center" class="small-muted">© Portfolio Builder — 2025</footer>
      </main>
    </div>
  </div>

  <!-- overlay -->
  <div id="pageOverlay" class="page-full" style="display:none">
    <div class="page-card" id="pageCard"></div>
  </div>

<script>
/* STORAGE & MODEL */
const STORAGE_KEY = 'portfolio_builder_final_v3';
const root = document.getElementById('root');
const app = document.getElementById('app');
const pageOverlay = document.getElementById('pageOverlay');
const pageCard = document.getElementById('pageCard');

const emptyModel = {
  profile: {
    name:'', desc:'', email:'', phone:'', github:'', linkedin:'', instagram:'', tiktok:'', x:'', photo:''
  },
  skills: [],
  projects: []
};

function saveModel(m){ localStorage.setItem(STORAGE_KEY, JSON.stringify(m)); }
function loadModel(){ try{ const raw = localStorage.getItem(STORAGE_KEY); return raw ? JSON.parse(raw) : null; }catch(e){return null;} }
function clearModel(){ localStorage.removeItem(STORAGE_KEY); }

/* HELPERS */
function esc(s){ return String(s||''); }
function initialsSVG(name,w=400,h=400){
  const initials = (name||'').split(' ').map(x=>x[0]).filter(Boolean).slice(0,2).join('').toUpperCase() || '--';
  const bg = '#1e293b', txt = '#fff';
  const svg = `<svg xmlns='http://www.w3.org/2000/svg' width='${w}' height='${h}'><rect width='100%' height='100%' fill='${bg}'/><text x='50%' y='50%' fill='${txt}' font-family='Poppins' font-size='120' text-anchor='middle' dominant-baseline='central'>${initials}</text></svg>`;
  return 'data:image/svg+xml;utf8,' + encodeURIComponent(svg);
}
function placeholderProject(title){
  const svg = `<svg xmlns='http://www.w3.org/2000/svg' width='900' height='600'><rect width='100%' height='100%' fill='%232b2b56'/><text x='50%' y='50%' fill='%23fff' font-family='Poppins' font-size='32' text-anchor='middle' dominant-baseline='central'>${esc(title||'Project')}</text></svg>`;
  return 'data:image/svg+xml;utf8,' + encodeURIComponent(svg);
}

/* RENDER */
function renderUI(){
  const model = loadModel() || emptyModel;
  setTheme('portfolio');

  document.getElementById('titleName').textContent = model.profile.name || '';
  document.getElementById('titleRole').textContent = model.profile.name ? 'Web Basic Developer — Portfolio' : '';

  document.getElementById('heroGreeting').innerHTML = model.profile.name ? `Halo, <strong>${esc(model.profile.name)}</strong>` : 'Halo! Silakan isi profil Anda.';
  document.getElementById('heroDesc').textContent = model.profile.desc || '';

  document.getElementById('aboutText').textContent = model.profile.desc || '';

  // skills animated
  const skillsWrap = document.getElementById('skillsWrap');
  skillsWrap.innerHTML = '';
  (model.skills || []).forEach((s,i)=> {
    const d = document.createElement('div'); d.className='skill'; d.textContent = s;
    d.style.opacity=0; d.style.transform='translateY(8px)'; skillsWrap.appendChild(d);
    setTimeout(()=>{ d.style.opacity=1; d.style.transform='translateY(0)'; }, 120 + i*80);
  });

  // avatar & logo
  const avatar = document.getElementById('avatarImg');
  const logo = document.getElementById('logoImg');
  const photo = model.profile.photo || '';
  const name = model.profile.name || '';
  avatar.src = photo || initialsSVG(name);
  logo.src = photo || initialsSVG(name,200,200);

  document.getElementById('nameShort').textContent = model.profile.name || '';
  document.getElementById('roleShort').textContent = model.profile.desc || '';

  // contact chips
  document.getElementById('emailChip').textContent = model.profile.email || '';
  document.getElementById('githubChip').textContent = model.profile.github ? ('GitHub: ' + model.profile.github) : 'GitHub: -';
  document.getElementById('linkedinChip').textContent = model.profile.linkedin || '';

  // socials in profile & contact area (monochrome white icons)
  renderSocials(model);

  // projects grid
  const grid = document.getElementById('projectsGrid');
  grid.innerHTML = '';
  (model.projects || []).forEach((p, idx)=>{
    const card = document.createElement('article'); card.className='project';
    card.innerHTML = `
      <img src="${p.image || placeholderProject(p.title)}" alt="${esc(p.title)}">
      <h4>${esc(p.title)}</h4>
      <p class="small-muted">${esc(p.desc)}</p>
      <div class="links">
        <a class="chip" href="${p.demo || '#'}" target="_blank">Demo</a>
        <a class="chip" href="${p.github || '#'}" target="_blank">GitHub</a>
        <button class="chip" data-idx="${idx}" onclick="onEditProject(event)">Edit</button>
        <button class="chip" data-idx="${idx}" onclick="onDeleteProject(event)">Hapus</button>
      </div>
    `;
    grid.appendChild(card);
  });

  // reveal
  document.querySelectorAll('.reveal').forEach((el,i)=>setTimeout(()=>el.classList.add('show'), 120 + i*80));
}

/* Social icons (monochrome white SVGs) */
function renderSocials(model){
  const wrap1 = document.getElementById('socialsWrap');
  const wrap2 = document.getElementById('socialsContact');
  wrap1.innerHTML = ''; wrap2.innerHTML = '';
  const socials = [
    {key:'github', url:model.profile.github, svg:ICON_GIT},
    {key:'linkedin', url:model.profile.linkedin, svg:ICON_LINKEDIN},
    {key:'instagram', url:model.profile.instagram, svg:ICON_INSTAGRAM},
    {key:'tiktok', url:model.profile.tiktok, svg:ICON_TIKTOK},
    {key:'x', url:model.profile.x, svg:ICON_X},
    {key:'wa', url: model.profile.phone ? ('https://wa.me/' + model.profile.phone.replace(/[^0-9]/g,'')) : '', svg:ICON_WA}
  ];
  socials.forEach(s=>{
    const el = document.createElement('a'); el.href = s.url || '#'; el.target = '_blank';
    el.title = s.key;
    el.innerHTML = s.svg;
    wrap1.appendChild(el);
    const el2 = el.cloneNode(true);
    wrap2.appendChild(el2);
  });
}

/* THEMES */
function setTheme(name){
  const map = {portfolio:'theme-portfolio', profile:'theme-profile', project:'theme-project'};
  document.documentElement.classList.remove('theme-portfolio','theme-profile','theme-project');
  root.classList.remove('theme-portfolio','theme-profile','theme-project');
  root.classList.add(map[name]);
}

/* OVERLAYS */
function openEditProfile(){
  setTheme('profile');
  const m = loadModel() || JSON.parse(JSON.stringify(emptyModel));
  pageCard.innerHTML = `
    <div class="page-title">
      <h3>Edit Profil</h3>
      <div><button class="btn ghost" id="closePage">Tutup</button></div>
    </div>
    <div style="display:flex;gap:16px;flex-wrap:wrap">
      <div style="flex:1;min-width:260px">
        <div class="field"><label class="small-muted">Nama</label><input id="pfName" type="text" value="${esc(m.profile.name)}"></div>
        <div class="field"><label class="small-muted">Deskripsi singkat</label><textarea id="pfDesc">${esc(m.profile.desc)}</textarea></div>
        <div class="field"><label class="small-muted">Email</label><input id="pfEmail" type="email" value="${esc(m.profile.email)}"></div>
        <div class="field"><label class="small-muted">Nomor WA (international, tanpa +)</label><input id="pfPhone" type="text" placeholder="6281234567890" value="${esc(m.profile.phone)}"></div>
        <div class="field"><label class="small-muted">GitHub (url)</label><input id="pfGit" type="text" value="${esc(m.profile.github)}"></div>
        <div class="field"><label class="small-muted">LinkedIn (url)</label><input id="pfLinked" type="text" value="${esc(m.profile.linkedin)}"></div>
        <div class="field"><label class="small-muted">Instagram (url)</label><input id="pfInsta" type="text" value="${esc(m.profile.instagram)}"></div>
        <div class="field"><label class="small-muted">TikTok (url)</label><input id="pfTiktok" type="text" value="${esc(m.profile.tiktok)}"></div>
        <div class="field"><label class="small-muted">X / Twitter (url)</label><input id="pfX" type="text" value="${esc(m.profile.x)}"></div>
        <div class="field"><label class="small-muted">Skills (pisah dengan koma)</label><input id="pfSkills" type="text" placeholder="HTML, CSS, JavaScript" value="${(m.skills||[]).join(', ')}"></div>
      </div>
      <div style="width:260px">
        <div style="margin-bottom:8px"><label class="small-muted">Foto Profil</label></div>
        <div style="width:220px;height:220px;border-radius:16px;overflow:hidden;background:#fff;display:flex;align-items:center;justify-content:center;margin-bottom:10px">
          <img id="pfPreview" src="${m.profile.photo || initialsSVG(m.profile.name)}" style="width:100%;height:100%;object-fit:cover">
        </div>
        <input id="pfFile" type="file" accept="image/*">
        <p class="small-muted" style="margin-top:8px">Foto disimpan di browser (localStorage). Disarankan ukuran &lt; 500KB.</p>
      </div>
    </div>
    <div style="display:flex;gap:10px;justify-content:flex-end;margin-top:12px">
      <button class="btn primary" id="saveProfileBtn">Simpan Profil</button>
      <button class="btn ghost" id="cancelProfileBtn">Batal</button>
    </div>
  `;
  pageOverlay.style.display='flex';
  pageOverlay.classList.add('theme-profile');

  document.getElementById('closePage').onclick = () => closeOverlayAndRender();
  document.getElementById('cancelProfileBtn').onclick = () => closeOverlayAndRender();

  document.getElementById('pfFile').addEventListener('change', e=>{
    const f = e.target.files && e.target.files[0];
    if(!f) return;
    const r = new FileReader();
    r.onload = ev => document.getElementById('pfPreview').src = ev.target.result;
    r.readAsDataURL(f);
  });

  document.getElementById('saveProfileBtn').addEventListener('click', ()=>{
    const modelNow = loadModel() || JSON.parse(JSON.stringify(emptyModel));
    modelNow.profile.name = document.getElementById('pfName').value.trim();
    modelNow.profile.desc = document.getElementById('pfDesc').value.trim();
    modelNow.profile.email = document.getElementById('pfEmail').value.trim();
    modelNow.profile.phone = document.getElementById('pfPhone').value.trim();
    modelNow.profile.github = document.getElementById('pfGit').value.trim();
    modelNow.profile.linkedin = document.getElementById('pfLinked').value.trim();
    modelNow.profile.instagram = document.getElementById('pfInsta').value.trim();
    modelNow.profile.tiktok = document.getElementById('pfTiktok').value.trim();
    modelNow.profile.x = document.getElementById('pfX').value.trim();
    modelNow.skills = (document.getElementById('pfSkills').value || '').split(',').map(s=>s.trim()).filter(Boolean);
    modelNow.profile.photo = document.getElementById('pfPreview').src || '';
    saveModel(modelNow);
    closeOverlayAndRender();
  });
}

function openAddProject(existing=null, idx=null){
  setTheme('project');
  const item = existing || {title:'',desc:'',demo:'',github:'',image:''};
  pageCard.innerHTML = `
    <div class="page-title">
      <h3>${existing ? 'Edit Proyek' : 'Tambah Proyek'}</h3>
      <div><button class="btn ghost" id="closePage2">Tutup</button></div>
    </div>
    <div style="display:flex;gap:16px;flex-wrap:wrap">
      <div style="flex:1;min-width:240px">
        <div class="field"><label class="small-muted">Judul Proyek</label><input id="pTitle" type="text" value="${esc(item.title)}"></div>
        <div class="field"><label class="small-muted">Deskripsi</label><textarea id="pDesc">${esc(item.desc)}</textarea></div>
        <div class="field"><label class="small-muted">Link Demo (opsional)</label><input id="pDemo" type="text" value="${esc(item.demo)}"></div>
        <div class="field"><label class="small-muted">Link GitHub (opsional)</label><input id="pGit" type="text" value="${esc(item.github)}"></div>
      </div>
      <div style="width:260px">
        <div style="margin-bottom:8px"><label class="small-muted">Gambar Proyek (opsional)</label></div>
        <div style="width:220px;height:140px;border-radius:10px;overflow:hidden;background:#fff;display:flex;align-items:center;justify-content:center;margin-bottom:10px">
          <img id="pPreview" src="${item.image || placeholderProject(item.title)}" style="width:100%;height:100%;object-fit:cover">
        </div>
        <input id="pFile" type="file" accept="image/*">
        <p class="small-muted">Gambar disimpan di browser.</p>
      </div>
    </div>
    <div style="display:flex;gap:10px;justify-content:flex-end;margin-top:12px">
      <button class="btn primary" id="saveProjectBtn">${existing ? 'Simpan Perubahan' : 'Tambah Proyek'}</button>
      <button class="btn ghost" id="cancelProjectBtn">Batal</button>
    </div>
  `;
  pageOverlay.style.display='flex';
  pageOverlay.classList.add('theme-project');

  document.getElementById('closePage2').onclick = () => closeOverlayAndRender();
  document.getElementById('cancelProjectBtn').onclick = () => closeOverlayAndRender();

  document.getElementById('pFile').addEventListener('change', e=>{
    const f = e.target.files && e.target.files[0];
    if(!f) return;
    const r = new FileReader();
    r.onload = ev => document.getElementById('pPreview').src = ev.target.result;
    r.readAsDataURL(f);
  });

  document.getElementById('saveProjectBtn').addEventListener('click', ()=>{
    const modelNow = loadModel() || JSON.parse(JSON.stringify(emptyModel));
    const newItem = {
      title: document.getElementById('pTitle').value.trim() || 'Untitled',
      desc: document.getElementById('pDesc').value.trim(),
      demo: document.getElementById('pDemo').value.trim(),
      github: document.getElementById('pGit').value.trim(),
      image: document.getElementById('pPreview').src || ''
    };
    if(idx !== null && idx >= 0) modelNow.projects[idx] = newItem;
    else modelNow.projects.unshift(newItem);
    saveModel(modelNow);
    closeOverlayAndRender();
    location.hash = '#projects';
  });
}

function closeOverlayAndRender(){
  pageOverlay.style.display='none';
  pageOverlay.classList.remove('theme-profile','theme-project');
  renderUI();
}

/* edit/delete */
function onEditProject(ev){
  const idx = Number(ev.currentTarget.dataset.idx);
  const model = loadModel() || emptyModel;
  openAddProject(model.projects[idx], idx);
}
function onDeleteProject(ev){
  const idx = Number(ev.currentTarget.dataset.idx);
  if(!confirm('Hapus proyek ini?')) return;
  const model = loadModel() || emptyModel;
  model.projects.splice(idx,1);
  saveModel(model);
  renderUI();
}

/* import/export/reset */
document.getElementById('btnExport').addEventListener('click', ()=>{
  const model = loadModel() || emptyModel;
  const blob = new Blob([JSON.stringify(model, null, 2)], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href = url; a.download = 'portfolio-data.json'; a.click();
  URL.revokeObjectURL(url);
});

document.getElementById('btnImport').addEventListener('click', ()=>{
  pageCard.innerHTML = `
    <div class="page-title"><h3>Import Data JSON</h3><div><button class="btn ghost" id="cancelImport">Batal</button></div></div>
    <div>
      <p class="small-muted">Pilih file JSON hasil export untuk memuat profil & proyek. Data yang ada akan diganti.</p>
      <input id="importFile" type="file" accept="application/json" style="margin-top:10px">
      <div style="display:flex;justify-content:flex-end;margin-top:12px"><button class="btn primary" id="doImport">Import</button></div>
    </div>
  `;
  pageOverlay.style.display='flex';
  pageOverlay.classList.add('theme-profile');
  document.getElementById('cancelImport').onclick = ()=>{ pageOverlay.style.display='none'; renderUI(); };
  document.getElementById('doImport').onclick = ()=>{
    const f = document.getElementById('importFile').files && document.getElementById('importFile').files[0];
    if(!f){ alert('Pilih file JSON terlebih dahulu.'); return; }
    const r = new FileReader();
    r.onload = ev => {
      try{ const parsed = JSON.parse(ev.target.result); saveModel(parsed); pageOverlay.style.display='none'; renderUI(); alert('Import sukses.'); }
      catch(e){ alert('File JSON tidak valid.'); }
    };
    r.readAsText(f);
  };
});

document.getElementById('btnReset').addEventListener('click', ()=>{
  if(confirm('Reset semua data? (tidak bisa dibatalkan)')){ clearModel(); setTimeout(()=>initialize(true),100); }
});

/* CONTACT via WhatsApp */
document.getElementById('contactSend').addEventListener('click', ()=>{
  const name = document.getElementById('contactName').value.trim();
  const email = document.getElementById('contactEmail').value.trim();
  const message = document.getElementById('contactMessage').value.trim();
  if(!name || !email || !message){ alert('Isi semua field (Nama, Email, Pesan).'); return; }

  const model = loadModel() || emptyModel;
  const phone = (model.profile && model.profile.phone) ? model.profile.phone.trim() : '';
  if(!phone){ alert('Nomor WA belum diisi di Edit Profil. Silakan isi (format internasional, contoh 6281234567890).'); openEditProfile(); return; }
  const digits = phone.replace(/[^0-9]/g,'');
  if(!digits){ alert('Nomor WA tidak valid. Periksa kembali.'); openEditProfile(); return; }

  const base = 'Halo, saya tertarik dengan portfolio Anda di website ini.';
  const extra = ` Nama: ${name} | Email: ${email} | Pesan: ${message}`;
  const text = encodeURIComponent(base + extra);
  const url = `https://wa.me/${digits}?text=${text}`;
  window.open(url,'_blank');
});

document.getElementById('contactClear').addEventListener('click', ()=>{
  document.getElementById('contactName').value=''; document.getElementById('contactEmail').value=''; document.getElementById('contactMessage').value='';
});

/* typing */
const roles = ['Web Developer','Fisikawan','Educator'];
let ri=0, ci=0, fwd=true;
const typedEl = document.getElementById('typed');
function typeLoop(){
  const w = roles[ri];
  if(fwd){ ci++; typedEl.textContent = w.slice(0,ci); if(ci===w.length){ fwd=false; setTimeout(typeLoop,1000); return; } }
  else { ci--; typedEl.textContent = w.slice(0,ci); if(ci===0){ fwd=true; ri=(ri+1)%roles.length; } }
  setTimeout(typeLoop, fwd?90:40);
}
typeLoop();

/* progress bar */
function updateProgress(){ const h = document.documentElement.scrollHeight - window.innerHeight; const sc = window.scrollY; const pct = h>0 ? (sc/h)*100 : 0; document.getElementById('progress').style.width = pct + '%'; }
window.addEventListener('scroll', updateProgress); window.addEventListener('resize', updateProgress); updateProgress();

/* overlay backdrop close */
pageOverlay.addEventListener('click', e=>{ if(e.target===pageOverlay){ pageOverlay.style.display='none'; pageOverlay.classList.remove('theme-profile','theme-project'); renderUI(); } });

/* init & bindings */
function initialize(forceShow=false){
  const model = loadModel();
  root.classList.add('theme-portfolio');
  if(!model || forceShow){ saveModel(JSON.parse(JSON.stringify(emptyModel))); openEditProfile(); }
  else renderUI();
}
document.getElementById('openEditProfile').addEventListener('click', openEditProfile);
document.getElementById('openAddProject').addEventListener('click', ()=>openAddProject());
window.onEditProject = onEditProject; window.onDeleteProject = onDeleteProject;
document.addEventListener('DOMContentLoaded', ()=> initialize());

/* ---------------------------
   Monochrome SVG ICONS (white)
   --------------------------- */
const ICON_GIT = `<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 .5a11.5 11.5 0 00-3.63 22.41c.57.1.78-.24.78-.54v-1.9c-3.18.69-3.85-1.53-3.85-1.53-.52-1.32-1.27-1.67-1.27-1.67-1.04-.71.08-.7.08-.7 1.15.08 1.75 1.18 1.75 1.18 1.02 1.74 2.68 1.24 3.33.95.1-.74.4-1.24.73-1.53-2.54-.29-5.22-1.27-5.22-5.66 0-1.25.45-2.27 1.18-3.07-.12-.29-.51-1.46.11-3.05 0 0 .96-.31 3.13 1.17a10.8 10.8 0 015.7 0c2.17-1.48 3.13-1.17 3.13-1.17.62 1.59.23 2.76.11 3.05.73.8 1.18 1.82 1.18 3.07 0 4.4-2.69 5.37-5.25 5.65.41.36.77 1.08.77 2.18v3.24c0 .3.21.65.79.54A11.5 11.5 0 0012 .5z"/></svg>`;
const ICON_LINKEDIN = `<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20.45 20.45h-3.6v-5.4c0-1.29-.02-2.95-1.8-2.95-1.8 0-2.08 1.41-2.08 2.86v5.5h-3.6V9h3.46v1.56h.05c.48-.9 1.65-1.84 3.4-1.84 3.64 0 4.31 2.4 4.31 5.52v6.72zM5.34 7.43a2.09 2.09 0 110-4.18 2.09 2.09 0 010 4.18zM7.14 20.45H3.55V9h3.59v11.45z"/></svg>`;
const ICON_INSTAGRAM = `<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M7 2h10a5 5 0 015 5v10a5 5 0 01-5 5H7a5 5 0 01-5-5V7a5 5 0 015-5zm5 6.2A4.8 4.8 0 1016.8 13 4.8 4.8 0 0012 8.2zm6.5-.9a1.1 1.1 0 11-1.1-1.1 1.1 1.1 0 011.1 1.1zM12 15.2A3.2 3.2 0 1115.2 12 3.2 3.2 0 0112 15.2z"/></svg>`;
const ICON_TIKTOK = `<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9 3v10.5A3.5 3.5 0 1012.5 7H14a6 6 0 01-5 6v1.5A4.5 4.5 0 109 7V3z"/></svg>`;
const ICON_X = `<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M21 5.5a1 1 0 00-1.4-.1L12 12 4.4 5.4A1 1 0 003 6.8L10.6 13.4 3 21a1 1 0 101.4 1.4L12 14.6l7.6 7.8A1 1 0 0021 21.6l-7.6-7.8L21 6.8A1 1 0 0021 5.5z"/></svg>`;
const ICON_WA = `<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20.52 3.48A11.86 11.86 0 0012 0C5.372 0 .1 5.372.1 12c0 2.124.555 4.2 1.61 6.03L0 24l6.24-1.64A11.85 11.85 0 0012 24c6.627 0 12-5.372 12-12 0-3.2-1.24-6.2-3.48-8.52zM12 21.5c-1.9 0-3.74-.48-5.36-1.38l-.38-.22-3.72.98.99-3.63-.24-.39A9.5 9.5 0 012.5 12c0-5.25 4.25-9.5 9.5-9.5 2.54 0 4.93.99 6.76 2.82A9.53 9.53 0 0121.5 12c0 5.25-4.25 9.5-9.5 9.5z"/></svg>`;
</script>
</body>
</html>
